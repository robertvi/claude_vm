##
## Restrictive Tinyproxy Configuration for Claude Code Container
## This configuration allows only essential domains for Claude API and common package managers
##

User nobody
Group nogroup

# Bind to all interfaces so container can access it
# Only accept connections from localhost and container network
Bind 0.0.0.0
Port 8888

# Timeout: If no data is received or sent for this amount of time, close connection
Timeout 600

# ErrorFile: Defines the HTML file to send when a given HTTP error occurs
DefaultErrorFile "/usr/share/tinyproxy/default.html"

# StatFile: HTML file to serve for stat host requests
StatFile "/usr/share/tinyproxy/stats.html"

# LogFile: path to log file
LogFile "/var/log/tinyproxy/tinyproxy.log"

# LogLevel: Set the logging level
# Critical (least verbose), Error, Warning, Notice, Connect (to log connections), Info
LogLevel Info

# PidFile: Write the PID to this file
PidFile "/run/tinyproxy/tinyproxy.pid"

# MaxClients: Maximum number of client connections
MaxClients 100

# Allow: Access control list
# Allow connections from localhost and Docker/Podman bridge network
Allow 127.0.0.1
Allow ::1
Allow 10.0.0.0/8
Allow 172.16.0.0/12
Allow 192.168.0.0/16

# ViaProxyName: Via hostname to use
ViaProxyName "tinyproxy"

# DisableViaHeader: Don't send the Via header
#DisableViaHeader Yes

# ConnectPort: Ports allowed for CONNECT method (for HTTPS)
# Allow standard HTTPS and HTTP ports
ConnectPort 443
ConnectPort 563
ConnectPort 80

##
## RESTRICTIVE MODE: Domain filtering using filter file
##

# Enable URL filtering with whitelist
Filter "/etc/tinyproxy/filter"
FilterURLs On
FilterExtended On
FilterDefaultDeny Yes
